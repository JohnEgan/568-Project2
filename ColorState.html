<!DOCTYPE html>
<style>

.states :hover {
  fill: red;
}

.state-borders {
  fill: none;
  stroke: #fff;
  stroke-width: 0.5px;
  stroke-linejoin: round;
  stroke-linecap: round;
  pointer-events: none;
}

div.tooltip {
        color: #222;
        background-color: #fff;
        padding: .5em;
        text-shadow: #f5f5f5 0 1px 0;
        border-radius: 2px;
        opacity: 0.9;
        position: absolute;
    }
</style>
<nav>
  <ul class="nav">
    <li><a href="index.html">Home</a></li>
    <li><a href="basicScatterPlot.html">Scatter 1</a></li>
    <li><a href="barchartCollegePerState.html">Bar chart 1</a></li>
    <li><a href="ColorState.html">State Image</a></li>
  </ul>
</nav>
<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script>

var svg = d3.select("svg");

var path = d3.geoPath();

var tooltip = d3.select('body').append('div')
            .attr('class', 'hidden tooltip');
//
//d3.json("https://d3js.org/us-10m.v1.json", function(error, us) {
  d3.json("./data/states-albers-10m.json", function(error, us) {
  console.log(us);
  if (error) throw error;
  d3.csv('AllStatesEducationLevelsTest.csv' , function(education)
  {
    console.table(education)

    var MedianEarnings = [];
    var column_num = 'MedianEarnings';
    for(var i=0; i<51; i++) {

    var value = education[i][column_num];
    MedianEarnings.push(+value);   

    }

    var colorInterpolator = d3.interpolateRgbBasis(["blue", "steelblue", "green", "purple", "red"])
    console.log(colorInterpolator)
    
    // if the data is scaled using linear scale
    let linearScale = d3.scaleLinear()
        .domain(d3.extent(MedianEarnings, d => d.value))

  svg.append("g")
      .attr("class", "states")
    .selectAll("path")
    .data(topojson.feature(us, us.objects.states).features)
    .enter().append("path")
      .attr("d", path)
      .attr("fill",  colorInterpolator(linearScale(MedianEarnings)))
      .on("click", click)
      .on('mousemove', function(d) {
          var mouse = d3.mouse(svg.node()).map(function(d) {
                  return parseInt(d);
          });
          let state = education.filter(function(edu) {return edu.GeographicAreaName == d.properties.name});
          tooltip.classed('hidden', false)
                          .attr('style', 'left:' + (mouse[0] + 15) +
                                  'px; top:' + (mouse[1] - 35) + 'px')
                          .html(d.properties.name + "<br>Total Population:" + state[0]["Population"] +"<br>Median Income (Over 25): $" + state[0]["MedianEarnings"]);
                  })
                  .on('mouseout', function() {
                      tooltip.classed('hidden', true);
                  });
              
     
  svg.append("path")
      .attr("class", "state-borders")
      .attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; })));

    })
});

function click(d) {
  console.log(d.properties.name);
  if(d.properties.name == 'Alabama'){
    window.open('https://www.youtube.com/watch?v=RrmWFjnAP2E');
  }
}


</script>